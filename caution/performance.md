---
layout: post
title: 性能周りの注意点
---

このページではStormを利用する際に性能周りで注意が必要な点をまとめます。

### StormからのZookeeperへのファイルIO負荷はそれなりに高い
主な原因としては頻度の高いHeartBeatをZooKeeperを用いて行っているための可能性が大きい。  
ZooKeeperは状態更新が行われた際に各サーバへのファイルIOが発生するため、HeartBeatの度にファイルIOが発生していることとなる。  
尚、ファイルIO回数は多いものの、ファイルIOの量は少ないため、ZooKeeperのデータを保持する場所をSSD上に移すことで大きく状況が改善することもある模様。  

尚、Stormにとっては動作しながらのクラスタ自体のアップデートへ対応する優先度は低いとされています。  
そのため、開発を待つのはなかなか時間がかかりそうです。

### Stormの動作がおかしくなった場合の対処方法
Supervisorが起動しなくなる、Workerが起動しなくなるなどStormが起動しなくなった場合、ZooKeeperか、ローカルのファイルの状態がおかしくなった可能性が大きい。  
そのため、以下の対処を順に行う。1でなおらなければ、2を行う。  
1.【Stormインストール先】のsupervisor、workersディレクトリを削除する  
2.ZooKeeper上の/storm 配下のデータを削除する  
2.【Stormインストール先】のnimbusディレクトリを削除  
  
Nimbusは基本起動し続けるためか、あまり状態がおかしくなることはない。そのため優先度は下げている。  
尚、これらの問題はバージョンが進むたびにどんどん対応されていく（バージョン0.8.2系で発生する問題がバージョン0.8.3系では発生しないなど）ため、バージョンアップを適宜行っていけば問題は発生しにくくなる。

